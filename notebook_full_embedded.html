
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebook Code</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap; /* Allows code to wrap within the container */
        }
        .output {
            background-color: #e0ffe0;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>Embedded Notebook Code</h1>

        <!-- Code Cell 1 -->
        <h2>Code Cell 1</h2>
        <pre><code># this block of code imports graphical libraries for plotting graphs with high resolution
%matplotlib inline
%config InlineBackend.figure_format = 'retina'
import matplotlib.pyplot as plt
import matplotlib as mpl
mpl.rcParams['figure.dpi'] = 120</code></pre>
        
        <!-- Code Cell 2 -->
        <h2>Code Cell 2</h2>
        <pre><code>!pip install -q usearch</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> [No output or unrecognized format]
                    </div>
                    
        <!-- Code Cell 3 -->
        <h2>Code Cell 3</h2>
        <pre><code># Libraries of functions need to be imported
import numpy as np
import pandas as pd
from sklearn.linear_model import Ridge
from scipy.spatial.distance import cdist
from usearch.index import search, MetricKind, Matches, BatchMatches
from sklearn import linear_model
from sklearn.preprocessing import StandardScaler, MinMaxScaler
from scipy.spatial import Delaunay
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import KFold, GridSearchCV
from sklearn.metrics import mean_squared_error as mse
from scipy import linalg
# from scipy.interpolate import interp1d, LinearNDInterpolator, NearestNDInterpolator
# from sklearn.decomposition import PCA

# the following line(s) are necessary if you want to make SKlearn compliant functions
from sklearn.base import BaseEstimator, RegressorMixin
from sklearn.utils.validation import check_X_y, check_array, check_is_fitted</code></pre>
        
        <!-- Code Cell 4 -->
        <h2>Code Cell 4</h2>
        <pre><code>data = pd.read_csv('https://github.com/dvasiliu/AAML/blob/main/Data%20Sets/cars.csv?raw=True')</code></pre>
        
        <!-- Code Cell 5 -->
        <h2>Code Cell 5</h2>
        <pre><code>data</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong>       MPG  CYL    ENG   WGT
0    18.0    8  307.0  3504
1    15.0    8  350.0  3693
2    18.0    8  318.0  3436
3    16.0    8  304.0  3433
4    17.0    8  302.0  3449
..    ...  ...    ...   ...
387  27.0    4  140.0  2790
388  44.0    4   97.0  2130
389  32.0    4  135.0  2295
390  28.0    4  120.0  2625
391  31.0    4  119.0  2720

[392 rows x 4 columns]
                    </div>
                    
        <!-- Code Cell 6 -->
        <h2>Code Cell 6</h2>
        <pre><code>y = data['MPG'].values
x = data.drop(columns=['MPG']).values</code></pre>
        
        <!-- Code Cell 7 -->
        <h2>Code Cell 7</h2>
        <pre><code># if we compute distances we need to put the attributes on the same scale
scaler = MinMaxScaler()
xscaled = scaler.fit_transform(x)</code></pre>
        
        <!-- Code Cell 8 -->
        <h2>Code Cell 8</h2>
        <pre><code>many_in_many: BatchMatches = search(xscaled, xscaled,392 , MetricKind.L2sq, exact=True)</code></pre>
        
        <!-- Code Cell 9 -->
        <h2>Code Cell 9</h2>
        <pre><code>one_in_many: Matches = search(xscaled, xscaled[0], len(xscaled), MetricKind.L2sq, exact=True)</code></pre>
        
        <!-- Code Cell 10 -->
        <h2>Code Cell 10</h2>
        <pre><code>dist = one_in_many.to_list()</code></pre>
        
        <!-- Code Cell 11 -->
        <h2>Code Cell 11</h2>
        <pre><code>dist.shape</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> (392, 392)
                    </div>
                    
        <!-- Code Cell 12 -->
        <h2>Code Cell 12</h2>
        <pre><code>dist</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> [(0, 0.0),
 (185, 0.0),
 (71, 0.0),
 (134, 0.0),
 (91, 0.0),
 (26, 0.0),
 (283, 0.0),
 (37, 0.0),
 (11, 0.0),
 (5, 0.0),
 (65, 0.0),
 (228, 0.0),
 (210, 0.0),
 (7, 0.0),
 (92, 0.0),
 (66, 0.0),
 (41, 0.0),
 (9, 0.0),
 (93, 0.0),
 (85, 0.0),
 (90, 0.0),
 (62, 0.0),
 (64, 0.0),
 (286, 0.0),
 (227, 0.0),
 (38, 0.0),
 (40, 0.0),
 (67, 0.0),
 (4, 0.0),
 (288, 0.0),
 (63, 0.0),
 (155, 0.0),
 (287, 0.0),
 (61, 0.0),
 (86, 0.0),
 (89, 0.0),
 (220, 0.0),
 (88, 0.0),
 (247, 0.0),
 (72, 0.0),
 (1, 0.0),
 (87, 0.0),
 (3, 0.0),
 (25, 0.0),
 (186, 0.0),
 (154, 0.0),
 (6, 0.0),
 (211, 0.0),
 (136, 0.0),
 (135, 0.0),
 (102, 0.0),
 (84, 0.0),
 (285, 0.0),
 (8, 0.0),
 (10, 0.0),
 (2, 0.0),
 (284, 0.0),
 (103, 0.0),
 (219, 0.0),
 (39, 0.0),
 (133, 0.1599999964237213),
 (248, 0.1599999964237213),
 (282, 0.1599999964237213),
 (36, 0.1599999964237213),
 (221, 0.1599999964237213),
 (261, 0.1599999964237213),
 (226, 0.1599999964237213),
 (156, 0.1599999964237213),
 (260, 0.1599999964237213),
 (42, 0.1599999964237213),
 (153, 0.1599999964237213),
 (94, 0.1599999964237213),
 (209, 0.1599999964237213),
 (162, 0.1599999964237213),
 (24, 0.1599999964237213),
 (187, 0.1599999964237213),
 (104, 0.1599999964237213),
 (259, 0.3199999928474426),
 (249, 0.3199999928474426),
 (122, 0.3199999928474426),
 (258, 0.3199999928474426),
 (281, 0.3199999928474426),
 (188, 0.3199999928474426),
 (35, 0.3199999928474426),
 (152, 0.3199999928474426),
 (225, 0.3199999928474426),
 (157, 0.3199999928474426),
 (161, 0.3199999928474426),
 (357, 0.3199999928474426),
 (359, 0.3199999928474426),
 (95, 0.3199999928474426),
 (222, 0.3199999928474426),
 (358, 0.3199999928474426),
 (123, 0.3199999928474426),
 (132, 0.3199999928474426),
 (208, 0.3199999928474426),
 (257, 0.47999998927116394),
 (131, 0.47999998927116394),
 (32, 0.47999998927116394),
 (15, 0.47999998927116394),
 (256, 0.47999998927116394),
 (34, 0.47999998927116394),
 (33, 0.47999998927116394),
 (255, 0.47999998927116394),
 (97, 0.47999998927116394),
 (158, 0.47999998927116394),
 (150, 0.47999998927116394),
 (151, 0.47999998927116394),
 (223, 0.47999998927116394),
 (159, 0.47999998927116394),
 (160, 0.47999998927116394),
 (356, 0.47999998927116394),
 (190, 0.47999998927116394),
 (355, 0.47999998927116394),
 (198, 0.47999998927116394),
 (98, 0.47999998927116394),
 (224, 0.47999998927116394),
 (189, 0.47999998927116394),
 (96, 0.47999998927116394),
 (124, 0.47999998927116394),
 (250, 0.47999998927116394),
 (197, 0.47999998927116394),
 (254, 0.47999998927116394),
 (262, 0.6399999856948853),
 (137, 0.6399999856948853),
 (289, 0.6399999856948853),
 (73, 0.6399999856948853),
 (296, 0.6399999856948853),
 (229, 0.6399999856948853),
 (163, 0.6399999856948853),
 (83, 0.6399999856948853),
 (101, 0.6399999856948853),
 (212, 0.6399999856948853),
 (184, 0.6399999856948853),
 (12, 0.6399999856948853),
 (218, 0.6399999856948853),
 (113, 0.6399999856948853),
 (27, 0.6399999856948853),
 (114, 0.6399999856948853),
 (60, 0.6399999856948853),
 (246, 0.6399999856948853),
 (43, 0.800000011920929),
 (23, 0.800000011920929),
 (100, 0.800000011920929),
 (206, 0.800000011920929),
 (105, 0.800000011920929),
 (112, 0.800000011920929),
 (13, 0.800000011920929),
 (120, 0.800000011920929),
 (121, 0.800000011920929),
 (391, 0.8598652482032776),
 (31, 0.9599999785423279),
 (130, 0.9599999785423279),
 (273, 0.9599999785423279),
 (280, 0.9599999785423279),
 (16, 0.9599999785423279),
 (277, 0.9599999785423279),
 (279, 0.9599999785423279),
 (278, 0.9599999785423279),
 (304, 0.9599999785423279),
 (149, 0.9599999785423279),
 (303, 0.9599999785423279),
 (45, 0.9599999785423279),
 (251, 0.9599999785423279),
 (380, 0.9599999785423279),
 (381, 0.9599999785423279),
 (354, 0.9599999785423279),
 (196, 0.9599999785423279),
 (199, 0.9599999785423279),
 (99, 0.9599999785423279),
 (360, 0.9599999785423279),
 (44, 0.9599999785423279),
 (207, 0.9599999785423279),
 (172, 0.9599999785423279),
 (46, 0.9599999785423279),
 (379, 0.9599999785423279),
 (191, 0.9599999785423279),
 (14, 0.9599999785423279),
 (125, 0.9599999785423279),
 (252, 0.9599999785423279),
 (253, 0.9599999785423279),
 (68, 1.0),
 (69, 1.0),
 (70, 1.0),
 (295, 1.0),
 (294, 1.0),
 (272, 1.159999966621399),
 (271, 1.159999966621399),
 (263, 1.2799999713897705),
 (138, 1.2799999713897705),
 (290, 1.2799999713897705),
 (298, 1.2799999713897705),
 (297, 1.2799999713897705),
 (74, 1.2799999713897705),
 (164, 1.2799999713897705),
 (82, 1.2799999713897705),
 (204, 1.2799999713897705),
 (205, 1.2799999713897705),
 (213, 1.2799999713897705),
 (217, 1.2799999713897705),
 (183, 1.2799999713897705),
 (230, 1.2799999713897705),
 (115, 1.2799999713897705),
 (28, 1.2799999713897705),
 (118, 1.2799999713897705),
 (119, 1.2799999713897705),
 (59, 1.2799999713897705),
 (245, 1.2799999713897705),
 (390, 1.4262518882751465),
 (129, 1.440000057220459),
 (274, 1.440000057220459),
 (275, 1.440000057220459),
 (276, 1.440000057220459),
 (148, 1.440000057220459),
 (17, 1.440000057220459),
 (302, 1.440000057220459),
 (314, 1.440000057220459),
 (305, 1.440000057220459),
 (166, 1.440000057220459),
 (336, 1.440000057220459),
 (313, 1.440000057220459),
 (312, 1.440000057220459),
 (170, 1.440000057220459),
 (174, 1.440000057220459),
 (353, 1.440000057220459),
 (328, 1.440000057220459),
 (165, 1.440000057220459),
 (337, 1.440000057220459),
 (167, 1.440000057220459),
 (171, 1.440000057220459),
 (335, 1.440000057220459),
 (22, 1.440000057220459),
 (378, 1.440000057220459),
 (382, 1.440000057220459),
 (47, 1.440000057220459),
 (173, 1.440000057220459),
 (195, 1.440000057220459),
 (200, 1.440000057220459),
 (106, 1.440000057220459),
 (361, 1.440000057220459),
 (111, 1.440000057220459),
 (383, 1.440000057220459),
 (237, 1.440000057220459),
 (238, 1.440000057220459),
 (192, 1.440000057220459),
 (30, 1.440000057220459),
 (126, 1.440000057220459),
 (270, 1.6399999856948853),
 (293, 1.6399999856948853),
 (324, 1.6399999856948853),
 (325, 1.6399999856948853),
 (323, 1.6399999856948853),
 (330, 1.7999999523162842),
 (329, 1.7999999523162842),
 (110, 1.7999999523162842),
 (239, 1.7999999523162842),
 (127, 1.9199999570846558),
 (128, 1.9199999570846558),
 (264, 1.9199999570846558),
 (265, 1.9199999570846558),
 (266, 1.9199999570846558),
 (267, 1.9199999570846558),
 (268, 1.9199999570846558),
 (269, 1.9199999570846558),
 (139, 1.9199999570846558),
 (140, 1.9199999570846558),
 (141, 1.9199999570846558),
 (142, 1.9199999570846558),
 (143, 1.9199999570846558),
 (144, 1.9199999570846558),
 (145, 1.9199999570846558),
 (292, 1.9199999570846558),
 (146, 1.9199999570846558),
 (147, 1.9199999570846558),
 (299, 1.9199999570846558),
 (300, 1.9199999570846558),
 (301, 1.9199999570846558),
 (75, 1.9199999570846558),
 (306, 1.9199999570846558),
 (308, 1.9199999570846558),
 (76, 1.9199999570846558),
 (309, 1.9199999570846558),
 (310, 1.9199999570846558),
 (291, 1.9199999570846558),
 (77, 1.9199999570846558),
 (311, 1.9199999570846558),
 (315, 1.9199999570846558),
 (316, 1.9199999570846558),
 (18, 1.9199999570846558),
 (78, 1.9199999570846558),
 (317, 1.9199999570846558),
 (318, 1.9199999570846558),
 (320, 1.9199999570846558),
 (321, 1.9199999570846558),
 (322, 1.9199999570846558),
 (80, 1.9199999570846558),
 (326, 1.9199999570846558),
 (81, 1.9199999570846558),
 (327, 1.9199999570846558),
 (307, 1.9199999570846558),
 (332, 1.9199999570846558),
 (19, 1.9199999570846558),
 (333, 1.9199999570846558),
 (334, 1.9199999570846558),
 (168, 1.9199999570846558),
 (338, 1.9199999570846558),
 (340, 1.9199999570846558),
 (341, 1.9199999570846558),
 (342, 1.9199999570846558),
 (344, 1.9199999570846558),
 (345, 1.9199999570846558),
 (346, 1.9199999570846558),
 (319, 1.9199999570846558),
 (79, 1.9199999570846558),
 (20, 1.9199999570846558),
 (347, 1.9199999570846558),
 (348, 1.9199999570846558),
 (349, 1.9199999570846558),
 (350, 1.9199999570846558),
 (352, 1.9199999570846558),
 (176, 1.9199999570846558),
 (177, 1.9199999570846558),
 (178, 1.9199999570846558),
 (179, 1.9199999570846558),
 (180, 1.9199999570846558),
 (362, 1.9199999570846558),
 (364, 1.9199999570846558),
 (21, 1.9199999570846558),
 (365, 1.9199999570846558),
 (182, 1.9199999570846558),
 (366, 1.9199999570846558),
 (339, 1.9199999570846558),
 (169, 1.9199999570846558),
 (368, 1.9199999570846558),
 (369, 1.9199999570846558),
 (370, 1.9199999570846558),
 (343, 1.9199999570846558),
 (371, 1.9199999570846558),
 (372, 1.9199999570846558),
 (373, 1.9199999570846558),
 (374, 1.9199999570846558),
 (375, 1.9199999570846558),
 (376, 1.9199999570846558),
 (377, 1.9199999570846558),
 (351, 1.9199999570846558),
 (175, 1.9199999570846558),
 (384, 1.9199999570846558),
 (385, 1.9199999570846558),
 (386, 1.9199999570846558),
 (388, 1.9199999570846558),
 (194, 1.9199999570846558),
 (389, 1.9199999570846558),
 (48, 1.9199999570846558),
 (49, 1.9199999570846558),
 (201, 1.9199999570846558),
 (202, 1.9199999570846558),
 (50, 1.9199999570846558),
 (203, 1.9199999570846558),
 (363, 1.9199999570846558),
 (181, 1.9199999570846558),
 (51, 1.9199999570846558),
 (367, 1.9199999570846558),
 (52, 1.9199999570846558),
 (214, 1.9199999570846558),
 (193, 1.9199999570846558),
 (215, 1.9199999570846558),
 (107, 1.9199999570846558),
 (216, 1.9199999570846558),
 (53, 1.9199999570846558),
 (54, 1.9199999570846558),
 (55, 1.9199999570846558),
 (56, 1.9199999570846558),
 (231, 1.9199999570846558),
 (232, 1.9199999570846558),
 (233, 1.9199999570846558),
 (57, 1.9199999570846558),
 (116, 1.9199999570846558),
 (234, 1.9199999570846558),
 (235, 1.9199999570846558),
 (58, 1.9199999570846558),
 (117, 1.9199999570846558),
 (236, 1.9199999570846558),
 (387, 1.9199999570846558),
 (29, 1.9199999570846558),
 (242, 1.9199999570846558),
 (243, 1.9199999570846558),
 (244, 1.9199999570846558),
 (331, 2.2799999713897705),
 (108, 2.2799999713897705),
 (109, 2.2799999713897705),
 (240, 2.2799999713897705),
 (241, 2.2799999713897705)]
                    </div>
                    
        <!-- Code Cell 13 -->
        <h2>Code Cell 13</h2>
        <pre><code>distances = cdist(xscaled,xscaled,metric='Euclidean')</code></pre>
        
        <!-- Code Cell 14 -->
        <h2>Code Cell 14</h2>
        <pre><code>distances.shape</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> (392, 392)
                    </div>
                    
        <!-- Markdown Cell 15 -->
        <h2>Markdown Cell 15</h2>
        <div class="markdown-content">
            ### Kernels for the Weights
        </div>
        
        <!-- Code Cell 16 -->
        <h2>Code Cell 16</h2>
        <pre><code># Gaussian Kernel
def Gaussian(x):
  return np.where(np.abs(x)>4,0,1/(np.sqrt(2*np.pi))*np.exp(-1/2*x**2))</code></pre>
        
        <!-- Code Cell 17 -->
        <h2>Code Cell 17</h2>
        <pre><code># this is the correct vectorized version
def Tricubic(x):
  return np.where(np.abs(x)>1,0,(1-np.abs(x)**3)**3)</code></pre>
        
        <!-- Code Cell 18 -->
        <h2>Code Cell 18</h2>
        <pre><code># Epanechnikov Kernel
def Epanechnikov(x):
  return np.where(np.abs(x)>1,0,3/4*(1-np.abs(x)**2))</code></pre>
        
        <!-- Code Cell 19 -->
        <h2>Code Cell 19</h2>
        <pre><code># Quartic Kernel
def Quartic(x):
  return np.where(np.abs(x)>1,0,15/16*(1-np.abs(x)**2)**2)</code></pre>
        
        <!-- Code Cell 20 -->
        <h2>Code Cell 20</h2>
        <pre><code>def kernel_function(d_ij,kern, tau):
    return kern(d_ij/(2*tau))</code></pre>
        
        <!-- Code Cell 21 -->
        <h2>Code Cell 21</h2>
        <pre><code># we want the weights
kern = Gaussian</code></pre>
        
        <!-- Code Cell 22 -->
        <h2>Code Cell 22</h2>
        <pre><code>weights = kernel_function(distances,kern,tau=0.05)</code></pre>
        
        <!-- Code Cell 23 -->
        <h2>Code Cell 23</h2>
        <pre><code>weights</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> array([[0.39894228, 0.18641149, 0.37609268, ..., 0.        , 0.        ,
        0.        ],
       [0.18641149, 0.39894228, 0.2173439 , ..., 0.        , 0.        ,
        0.        ],
       [0.37609268, 0.2173439 , 0.39894228, ..., 0.        , 0.        ,
        0.        ],
       ...,
       [0.        , 0.        , 0.        , ..., 0.39894228, 0.23888698,
        0.1772128 ],
       [0.        , 0.        , 0.        , ..., 0.23888698, 0.39894228,
        0.3846016 ],
       [0.        , 0.        , 0.        , ..., 0.1772128 , 0.3846016 ,
        0.39894228]])
                    </div>
                    
        <!-- Markdown Cell 24 -->
        <h2>Markdown Cell 24</h2>
        <div class="markdown-content">
            ### What happens next?

Answer: we multiply the weights with the data and we solve n linear regression problems.
        </div>
        
        <!-- Code Cell 25 -->
        <h2>Code Cell 25</h2>
        <pre><code># one set of weights is weights[:,0]
model = Ridge(alpha=0.001,max_iter=5000)</code></pre>
        
        <!-- Code Cell 26 -->
        <h2>Code Cell 26</h2>
        <pre><code>model.fit(np.diag(weights[:,0])@xscaled, np.diag(weights[:,0])@y)</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> Ridge(alpha=0.001, max_iter=5000)
                    </div>
                    
        <!-- Code Cell 27 -->
        <h2>Code Cell 27</h2>
        <pre><code>model.predict(xscaled[0].reshape(1,-1))</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> array([17.06248486])
                    </div>
                    
        <!-- Code Cell 28 -->
        <h2>Code Cell 28</h2>
        <pre><code>y[0]</code></pre>
        
                    <div class="output">
                        <strong>Output:</strong> 18.0
                    </div>
                    
        <!-- Code Cell 29 -->
        <h2>Code Cell 29</h2>
        <pre><code></code></pre>
        
</body>
</html>
